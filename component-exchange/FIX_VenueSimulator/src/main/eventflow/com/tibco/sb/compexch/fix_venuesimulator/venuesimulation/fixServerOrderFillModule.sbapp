<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<modify version="10.5.0-SNAPSHOT_a8f4a008b96ea7ff9200c11cd2c5388579e1621f">
    <add>
        <gui.metadata>
            <property name="description" value="this module will fill venue orders to simiulate various venues&#13;&#10;note that this should run concurrent to the caller, as there is a sleep() that could otherwise interfere and hold the module lock for too long and prevent new orders from being processed"/>
        </gui.metadata>
        <type-metadata>
            <param name="type" value="module"/>
            <param name="fully-qualified-name" value="com.tibco.sb.compexch.fix_venuesimulator.venuesimulation.fixServerOrderFillModule"/>
        </type-metadata>
        <memory-model-settings/>
        <import from="com.tibco.sb.compexch.fix_venuesimulator.reference.FIXdefs"/>
        <dynamic-variables>
            <dynamic-variable initial-expression="double(${FillQty})" name="DV_FillQty" setter-expression="FillQty" setter-stream="Constants"/>
            <dynamic-variable initial-expression="double(${FillRate})" name="DV_FillRate" setter-expression="FillRate" setter-stream="Constants"/>
            <dynamic-variable initial-expression="int(${FillSleepMilliSecs})" name="DV_FillSleepMilliSecs" setter-expression="FillSleepMilliSecs" setter-stream="Constants"/>
            <dynamic-variable initial-expression="false" name="DV_FillWaitMktOpenTrigger" setter-expression="bool(false)" setter-stream="StartFills"/>
        </dynamic-variables>
        <data name="VenueOrdersUnfilled" shared="false" source="input" type="querytable">
            <property name="description" value="table of unfilled orders that will be filled at some rate by this venue simulator"/>
            <param name="storage-method" value="heap"/>
            <param name="replicated" value="false"/>
            <table-schema schema="FIX_4_2_MsgType_8_ExecutionReport">
                <primary-index type="hash">
                    <field name="ClOrdID"/>
                </primary-index>
            </table-schema>
            <param name="truncate" value="false"/>
            <preload format="csv" mode="empty"/>
            <param name="gui:x" value="355"/>
            <param name="gui:y" value="101"/>
            <param name="gui:width" value="150"/>
            <param name="gui:height" value="70"/>
        </data>
        <stream name="Constants">
            <schema>
                <field name="FillQty" type="int"/>
                <field name="IOCCnclRt" type="int"/>
                <field name="FillRate" type="double"/>
                <field name="FillSleepMilliSecs" type="int"/>
            </schema>
            <param name="gui:x" value="-402"/>
            <param name="gui:y" value="586"/>
            <param name="gui:width" value="70"/>
        </stream>
        <stream name="FillAnother" scope="public">
            <property name="description" value="sbfeedsim into the FillAnother input stream for better control over fill rates"/>
            <schema>
                <field name="time" type="timestamp"/>
            </schema>
            <param name="gui:x" value="-556"/>
            <param name="gui:y" value="295"/>
            <param name="gui:width" value="70"/>
        </stream>
        <stream name="StartFills">
            <property name="description" value="this allows for the start of fills to be delay, if you want to simulate pre-market order submission.&#13;&#10;the default for this state is with the"/>
            <schema>
                <field description="any value including null" name="go" type="bool"/>
            </schema>
            <param name="gui:x" value="-257"/>
            <param name="gui:y" value="95"/>
            <param name="gui:width" value="70"/>
        </stream>
        <box name="NextFillCheck" type="metronome">
            <property name="description" value="kick off to look for unfilled orders.&#13;&#10;&#13;&#10;if you want to fill at various rates, then disable this metronome (set sleep time to a very high value) and use a sbfeedsim into the FillAnother input stream"/>
            <output port="1" stream="out:NextFillCheck_1"/>
            <param name="interval" value="${FillRate}"/>
            <param name="timestamp-field" value="time"/>
            <param name="gui:x" value="-577"/>
            <param name="gui:y" value="367"/>
            <param name="gui:width" value="70"/>
        </box>
        <box name="Union1" type="union">
            <input port="1" stream="FillAnother"/>
            <input port="2" stream="out:NextFillCheck_1"/>
            <output port="1" stream="out:Union1_1"/>
            <param name="strict" value="false"/>
            <param name="gui:x" value="-470"/>
            <param name="gui:y" value="329"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="-471,325;-471,345"/>
            <param name="gui:bends:2" value="-479,395;-479,370"/>
        </box>
        <box name="Wait4MktOpen" type="filter">
            <input port="1" stream="out:Union1_1"/>
            <output port="1" stream="out:Wait4MktOpen_1"/>
            <param name="autogen-nomatch-port" value="false"/>
            <param name="expression.0" value="true--! DV_FillWaitMktOpenTrigger"/>
            <param name="gui:x" value="-369"/>
            <param name="gui:y" value="330"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="-389,357;-389,358"/>
        </box>
        <box name="GetAllOpenOrders" type="query">
            <input port="1" stream="out:Wait4MktOpen_1"/>
            <output port="1" stream="out:GetAllOpenOrders_1"/>
            <dataref id="querytable" name="VenueOrdersUnfilled"/>
            <param name="operation" value="read"/>
            <param name="where" value="all-rows"/>
            <param name="write-type" value="insert"/>
            <param name="if-write-fails" value="ignore"/>
            <param name="no-match-mode" value="output-no-match-nothing"/>
            <param name="order-by-direction" value="none"/>
            <target-list>
                <item name="input" selection="none"/>
                <item name="current" selection="all"/>
                <item name="old" selection="none"/>
            </target-list>
            <param name="gui:x" value="-264"/>
            <param name="gui:y" value="330"/>
            <param name="gui:width" value="70"/>
        </box>
        <box name="Spacer" type="map">
            <input port="1" stream="out:GetAllOpenOrders_1"/>
            <output port="1" stream="out:Spacer_1"/>
            <target-list>
                <item name="input" selection="all"/>
                <expressions>
                    <include field="sleepTime">sleep(milliseconds(DV_FillSleepMilliSecs))</include>
                    <include field="DV_FillQty1">DV_FillQty</include>
                </expressions>
            </target-list>
            <param name="gui:x" value="-124"/>
            <param name="gui:y" value="319"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="-149,358;-149,348"/>
        </box>
        <box name="Split1" type="split">
            <input port="1" stream="out:Spacer_1"/>
            <output port="1" stream="out:Split1_1"/>
            <param name="output-count" value="1"/>
            <param name="gui:x" value="-11"/>
            <param name="gui:y" value="318"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="-31,348;-31,346"/>
        </box>
        <box name="PartialOr" type="filter">
            <input port="1" stream="out:Split1_1"/>
            <output port="1" stream="out:PartialOr_1"/>
            <output port="2" stream="out:PartialOr_2"/>
            <param name="autogen-nomatch-port" value="true"/>
            <param name="expression.0" value="LeavesQty&gt;DV_FillQty"/>
            <param name="expression.1" value="true"/>
            <param name="gui:x" value="95"/>
            <param name="gui:y" value="316"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="78,346;78,344"/>
        </box>
        <box name="complete" type="query">
            <input port="1" stream="out:PartialOr_2"/>
            <output port="1" stream="out:complete_1"/>
            <dataref id="querytable" name="VenueOrdersUnfilled"/>
            <param name="operation" value="delete"/>
            <param name="where" value="primary-key"/>
            <param name="key-field.0" value="ClOrdID"/>
            <param name="key-lowerbound-value.0" value="input1.ClOrdID"/>
            <param name="key-lowerbound-operation.0" value="eq"/>
            <param name="write-type" value="insert"/>
            <param name="if-write-fails" value="ignore"/>
            <param name="no-match-mode" value="output-no-match-nothing"/>
            <param name="order-by-direction" value="none"/>
            <target-list>
                <item name="input" selection="all">
                    <remove field="DV_FillQty1"/>
                </item>
                <item name="old" selection="none"/>
                <item name="new" selection="none"/>
            </target-list>
            <param name="gui:x" value="205"/>
            <param name="gui:y" value="380"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="172,357;172,408"/>
        </box>
        <box name="partial" type="query">
            <input port="1" stream="out:PartialOr_1"/>
            <output port="1" stream="out:partial_1"/>
            <dataref id="querytable" name="VenueOrdersUnfilled"/>
            <param name="operation" value="write"/>
            <param name="where" value="primary-key"/>
            <param name="key-field.0" value="ClOrdID"/>
            <param name="key-value.0" value="input1.ClOrdID"/>
            <param name="write-type" value="update"/>
            <param name="if-write-fails" value="ignore"/>
            <param name="no-match-mode" value="output-no-match-nothing"/>
            <param name="order-by-direction" value="none"/>
            <target-list>
                <item name="input" selection="none"/>
                <item name="old" selection="none"/>
                <item name="new" selection="all"/>
                <item name="current" selection="none"/>
            </target-list>
            <param name="update-field.0" value="LeavesQty"/>
            <param name="update-field.1" value="CumQty"/>
            <param name="update-field.2" value="AvgPx"/>
            <param name="update-value.0" value="old.LeavesQty-DV_FillQty"/>
            <param name="update-value.1" value="old.CumQty+DV_FillQty"/>
            <param name="update-value.2" value="old.Price"/>
            <param name="gui:x" value="201"/>
            <param name="gui:y" value="269"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="184,332;184,297"/>
        </box>
        <box name="OrderIDSequence1" type="seqnum">
            <property name="description" value="Generates a new OrderID for the outgoing Execution Report message."/>
            <input port="1" stream="out:partial_1"/>
            <output port="1" stream="out:OrderIDSequence1_1"/>
            <param name="output-field" value="ExecIDnew"/>
            <param name="sequence-id" value="sequenceEIDid"/>
            <param name="update-expression" value="sequenceEIDid + 1"/>
            <param name="gui:x" value="311"/>
            <param name="gui:y" value="269"/>
            <param name="gui:width" value="70"/>
        </box>
        <box name="OrderIDSequence2" type="seqnum">
            <property name="description" value="Generates a new OrderID for the outgoing Execution Report message."/>
            <input port="1" stream="out:complete_1"/>
            <output port="1" stream="out:OrderIDSequence2_1"/>
            <param name="output-field" value="ExecIDnew"/>
            <param name="sequence-id" value="sequenceEIDid"/>
            <param name="update-expression" value="sequenceEIDid + 1"/>
            <param name="gui:x" value="315"/>
            <param name="gui:y" value="380"/>
            <param name="gui:width" value="70"/>
        </box>
        <box name="ExecFill" type="map">
            <property name="description" value="Convert incoming NOS into an Execution Report &quot;Ack&quot; (OrdStatus=New) message"/>
            <input port="1" stream="out:OrderIDSequence2_1"/>
            <output port="1" stream="out:ExecFill_1"/>
            <target-list>
                <item name="input" selection="all">
                    <remove field="ExecIDnew"/>
                    <replace field="MsgType">'8'</replace>
                </item>
                <expressions>
                    <replace field="OrdStatus">'2'</replace>
                    <replace field="LeavesQty">int(0)</replace>
                    <replace field="CumQty">input1.OrderQty</replace>
                    <replace field="AvgPx">Price</replace>
                    <replace field="ExecID">string(ExecIDnew)</replace>
                    <replace field="ExecType">'2'</replace>
                    <replace field="ExecTransType">'0'</replace>
                    <replace field="LastShares">OrderQty-CumQty</replace>
                </expressions>
            </target-list>
            <param name="gui:x" value="425"/>
            <param name="gui:y" value="380"/>
            <param name="gui:width" value="70"/>
        </box>
        <box name="ExecPartial" type="map">
            <property name="description" value="Convert incoming NOS into an Execution Report &quot;Ack&quot; (OrdStatus=New) message"/>
            <input port="1" stream="out:OrderIDSequence1_1"/>
            <output port="1" stream="out:ExecPartial_1"/>
            <target-list>
                <item name="input" selection="all">
                    <remove field="ExecIDnew"/>
                    <replace field="MsgType">'8'</replace>
                    <replace field="LastShares">double(DV_FillQty)</replace>
                </item>
                <expressions>
                    <replace field="OrdStatus">'1'</replace>
                    <replace field="CumQty">OrderQty</replace>
                    <replace field="ExecID">string(ExecIDnew)</replace>
                    <replace field="ExecType">'1'</replace>
                    <replace field="ExecTransType">'0'</replace>
                </expressions>
            </target-list>
            <param name="gui:x" value="421"/>
            <param name="gui:y" value="269"/>
            <param name="gui:width" value="70"/>
        </box>
        <box name="FillOutput" type="union">
            <input port="1" stream="out:ExecPartial_1"/>
            <input port="2" stream="out:ExecFill_1"/>
            <output port="1" stream="out:FillOutput_1"/>
            <param name="strict" value="false"/>
            <param name="gui:x" value="555"/>
            <param name="gui:y" value="338"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="502,297;502,354"/>
            <param name="gui:bends:2" value="536,408;536,379"/>
        </box>
        <box name="CommonSettings" type="map">
            <input port="1" stream="out:FillOutput_1"/>
            <output port="1" stream="FillOutputStream"/>
            <target-list>
                <item name="input" selection="all">
                    <replace field="AvgPx">if(notnull(Price))  then Price else double(1.0)</replace>
                    <replace field="LastPx">if(notnull(Price))  then Price else double(1.0)</replace>
                </item>
            </target-list>
            <param name="gui:x" value="570"/>
            <param name="gui:y" value="431"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="724,366;724,425;524,425;524,459"/>
        </box>
        <output-stream name="FillOutputStream">
            <param name="gui:x" value="690"/>
            <param name="gui:y" value="436"/>
            <param name="gui:width" value="70"/>
            <param name="gui:bends:1" value="666,459;666,465"/>
        </output-stream>
        <gui.note name="See_MetaData_TAB">
            <property name="description" value="metat data explains purpose of this module&#13;&#10;parameters TAB contains default values&#13;&#10;definitions TAB contains schema info"/>
            <param name="gui:x" value="-567"/>
            <param name="gui:y" value="104"/>
            <param name="gui:width" value="260"/>
            <param name="gui:height" value="71"/>
        </gui.note>
        <gui.group color="192,192,192" name="Data_G" visual-state="open">
            <member name="VenueOrdersUnfilled"/>
            <param name="gui:x" value="340"/>
            <param name="gui:y" value="62"/>
            <param name="gui:width" value="180"/>
            <param name="gui:height" value="124"/>
        </gui.group>
        <gui.group color="128,255,255" name="PartialFillAlgo_G" visual-state="open">
            <property name="description" value="this group will take unfilled orders and do partial and complete fills at a predetermined rate"/>
            <member name="NextFillCheck"/>
            <member name="GetAllOpenOrders"/>
            <member name="PartialOr"/>
            <member name="complete"/>
            <member name="partial"/>
            <member name="OrderIDSequence1"/>
            <member name="OrderIDSequence2"/>
            <member name="ExecFill"/>
            <member name="ExecPartial"/>
            <member name="FillOutput"/>
            <member name="Union1"/>
            <member name="FillAnother"/>
            <member name="Split1"/>
            <member name="Spacer"/>
            <member name="FillOutputStream"/>
            <member name="CommonSettings"/>
            <member name="Wait4MktOpen"/>
            <param name="gui:x" value="-597"/>
            <param name="gui:y" value="229"/>
            <param name="gui:width" value="1385"/>
            <param name="gui:height" value="305"/>
        </gui.group>
        <gui.group color="255,128,192" name="Rates" visual-state="open">
            <property name="description" value="use this stream to set up some rates of cancel or IOC fill"/>
            <member name="Constants"/>
            <param name="gui:x" value="-417"/>
            <param name="gui:y" value="552"/>
            <param name="gui:width" value="100"/>
            <param name="gui:height" value="124"/>
        </gui.group>
        <gui.group color="128,128,255" name="StartFills_Group" visual-state="open">
            <property name="description" value="if market open, this will start fill process on orders"/>
            <member name="StartFills"/>
            <param name="gui:x" value="-272"/>
            <param name="gui:y" value="61"/>
            <param name="gui:width" value="100"/>
            <param name="gui:height" value="124"/>
        </gui.group>
    </add>
</modify>
